<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Ketcher is a web-based chemical structure editor" />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />
    <title>Ketcher v2.21.0</title>
    <script defer="defer" src="./static/js/main.1cd53ef5.js"></script>
    <link href="./static/css/main.e770f74b.css" rel="stylesheet">
</head>

<body><noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
        // Injected Bridge for Chemdraw Alternative
        (function () {
            var retries = 0;
            var maxRetries = 60; // 30 seconds

            function initBridge() {
                if (window.ketcher) {
                    console.log("[Bridge] Ketcher found. Initializing bridge...");

                    // Notify parent immediately
                    window.parent.postMessage({ type: 'KETCHER_READY' }, '*');

                    // Subscribe to changes
                    // Try standard onStructChange or internal editor subscribe
                    if (typeof window.ketcher.onStructChange === 'function') {
                        window.ketcher.onStructChange(function () {
                            sendStruct();
                        });
                    } else if (window.ketcher.editor) {
                        window.ketcher.editor.subscribe('change', function () {
                            sendStruct();
                        });
                    }

                    // Listen for requests from parent
                    window.addEventListener('message', function (e) {
                        if (e.data && e.data.type === 'GET_SMILES') {
                            sendStruct();
                        }
                    });

                    function sendStruct() {
                        window.ketcher.getSmiles(true).then(function (smiles) {
                            window.parent.postMessage({ type: 'KETCHER_STRUCT', smiles: smiles }, '*');
                        }).catch(function (err) {
                            console.error("[Bridge] Error getting smiles", err);
                        });
                    }

                } else {
                    if (retries < maxRetries) {
                        retries++;
                        setTimeout(initBridge, 500);
                    } else {
                        console.error("[Bridge] Ketcher not found after timeout.");
                    }
                }
            }

            initBridge();
        })();
    </script>
</body>

</html>